<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A fully featured admin theme which can be used to build CRM, CMS, etc.">
    <meta name="author" content="Coderthemes">

    <title>TAX Department</title>

    <link th:href="@{/static/css/components.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/static/css/icons.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/static/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>

    <link th:href="@{/static/plugins/datatables/jquery.dataTables.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/static/plugins/datatables/responsive.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/static/plugins/datatables/dataTables.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" th:href="@{http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css}">
    <link th:href="@{/static/css/core.css}" rel="stylesheet" type="text/css"/>
    <style>
        .table-action-btn {
            display: inline-block;
            width: 28px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-size: 20px;
        }

    </style>

    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>


</head>


<body class="fixed-left">

<div id="wrapper">
    <div class="topbar">

        <div class="topbar-left">
            <div class="text-center">
                <a href="/employees" class="logo"><i class="icon-magnet icon-c-logo"></i><span>TAX</span></a>
            </div>
        </div>

        <div class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="">
                    <div class="pull-left">
                        <button class="button-menu-mobile open-left waves-effect waves-light">
                            <i class="md md-menu"></i>
                        </button>
                        <span class="clearfix"></span>
                    </div>
                    <ul class="nav navbar-nav hidden-xs">
                        <li>
                            <a href="javascript:void(0);">
                                <span class="font-14">[[${#authentication.principal.userRole}]]</span>
                            </a>
                        </li>
                    </ul>
                    <form role="search" class="navbar-left app-search pull-left hidden-xs">
                        <input type="text" placeholder="Search..." class="form-control">
                        <a href=""><i class="fa fa-search"></i></a>
                    </form>


                    <ul class="nav navbar-nav navbar-right pull-right">
                        <li class="dropdown top-menu-item-xs">
                            <a href="" class="dropdown-toggle profile waves-effect waves-light" data-toggle="dropdown"
                               aria-expanded="true">User</a>
                            <ul class="dropdown-menu">
                                <li><a href="javascript:void(0)"><i class="ti-user m-r-10 text-custom"></i> Profile</a>
                                </li>
                                <li><a href="javascript:void(0)"><i class="ti-settings m-r-10 text-custom"></i> Settings</a>
                                </li>
                                <li><a href="javascript:void(0)"><i class="ti-lock m-r-10 text-custom"></i> Lock screen</a>
                                </li>
                                <li class="divider"></li>
                                <li><a href="/logout"><i class="ti-power-off m-r-10 text-danger"></i> Logout</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <div class="left side-menu">
        <div class="sidebar-inner slimscrollleft">
            <div id="sidebar-menu">
                <ul>
                    <li>
                        <a class="waves-effect" href="/api/currency">
                            <i class="fa fa-money"></i>
                            <span> Exchange rate </span>
                        </a>
                    </li>

                    <li class="has_sub">
                        <a href="javascript:void(0);" class="waves-effect"><i class="fa fa-pencil-square-o"></i>
                            <span> About committee </span> <span class="menu-arrow"></span> </a>
                        <ul class="list-unstyled">
                            <li><a href="#">About committee</a></li>
                            <li><a href="#">About committee</a></li>
                            <li><a href="#">About committee</a></li>
                            <li><a href="#">About committee</a></li>
                            <li><a href="#">About committee</a></li>
                        </ul>
                    </li>

                    <li class="has_sub">
                        <a href="javascript:void(0);" class="waves-effect"><i class="fa fa-pencil-square-o"></i><span
                                class="label label-primary pull-right">10</span><span> Activity </span> </a>
                        <ul class="list-unstyled">
                            <li><a href="#">Activity</a></li>
                            <li><a href="#">Activity</a></li>
                            <li><a href="#">Activity</a></li>
                            <li><a href="#">Activity</a></li>
                            <li><a href="#">Activity</a></li>
                            <li><a href="#">Activity</a></li>

                        </ul>
                    </li>

                    <li class="has_sub">
                        <a href="javascript:void(0);" class="waves-effect"><i class="fa fa-pencil-square-o"></i> <span> Regulatory docs </span>
                            <span class="menu-arrow"></span> </a>
                        <ul class="list-unstyled">
                            <li><a href="#">Regulatory docs</a></li>
                            <li><a href="#">Regulatory docs</a></li>
                            <li><a href="#">Regulatory docs</a></li>
                            <li><a href="#">Regulatory docs</a></li>
                            <li><a href="#">Regulatory docs</a></li>
                            <li><a href="#">Regulatory docs</a></li>
                        </ul>
                    </li>

                    <li class="has_sub">
                        <a href="javascript:void(0);" class="waves-effect"><i
                                class="fa fa-pencil-square-o"></i><span> Taxation </span> <span class="menu-arrow"></span></a>
                        <ul class="list-unstyled">
                            <li><a href="#">Taxation</a></li>
                            <li><a href="#">Taxation</a></li>
                            <li><a href="#">Taxation</a></li>
                            <li><a href="#">Taxation</a></li>
                            <li><a href="#">Taxation</a></li>
                            <li><a href="#">Taxation</a></li>
                        </ul>
                    </li>

                    <li class="has_sub">
                        <a href="javascript:void(0);" class="waves-effect" ><i
                                class="fa fa-pencil-square-o"></i><span>Press service </span> <span class="menu-arrow"></span></a>
                        <ul class="list-unstyled">
                            <li><a href="#">Press service</a></li>
                            <li><a href="#">Press service</a></li>
                            <li><a href="#">Press service</a></li>
                            <li><a href="#">Press service</a></li>
                            <li><a href="#">Press service</a></li>
                            <li><a href="#">Press service</a></li>
                        </ul>
                    </li>

                    <li class="has_sub">
                        <a href="javascript:void(0);" class="waves-effect"><i class="fa fa-pencil-square-o"></i><span
                                class="label label-pink pull-right">11</span><span> Services </span></a>
                        <ul class="list-unstyled">
                            <li><a href="#">Services</a></li>
                            <li><a href="#">Services</a></li>
                            <li><a href="#">Services</a></li>
                            <li><a href="#">Services</a></li>
                            <li><a href="#">Services</a></li>
                            <li><a href="#">Services</a></li>
                        </ul>
                    </li>

                    <li class="has_sub">
                        <a href="javascript:void(0);" class="waves-effect"><i class="fa fa-pencil-square-o"></i><span
                                class="label label-pink pull-right">11</span><span> Open data </span></a>
                        <ul class="list-unstyled">
                            <li><a href="#">Open data</a></li>
                            <li><a href="#">Open data</a></li>
                            <li><a href="#">Open data</a></li>
                            <li><a href="#">Open data</a></li>
                            <li><a href="#">Open data</a></li>
                            <li><a href="#">Open data</a></li>
                        </ul>
                    </li>

                </ul>
                <div class="clearfix"></div>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>

    <div class="content-page">
        <div class="content">
            <div class="container">

                <div class="row">
                    <div class="col-sm-12">

                        <div class="pull-right m-t-15">
                            <a href="/employees/form" type="button" sec:authorize="hasAnyAuthority('ROLE_ADMIN', 'ROLE_SUPER_ADMIN')"
                               class="btn btn-primary dropdown-toggle waves-effect waves-light get-modal m-r-5"
                               modalsize="xl">
                                <span>+ add</span>
                            </a>
                        </div>
                        <h4 class="page-title">Employees</h4>
                        <ol class="breadcrumb">
                            <li><a href="?page=dashboard">main</a></li>
                            <li>employees</li>
                        </ol>
                    </div>

                </div>


                <div class="row">
                    <div class="col-sm-12">
                        <div class="card-box table-responsive">
                            <table id="datatable" class="table table-hover table-actions-bar">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>name</th>
                                    <th>phoneNumber</th>
                                    <th>userRole</th>
                                    <th>email</th>
                                    <th>position</th>
                                    <th>salary</th>
                                    <th>createdAt</th>
                                    <th>state</th>
                                    <th></th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>


            </div>

        </div>

        <footer class="footer text-right">
            State Tax Committee Call us: <a dir="ltr" href="tel:+' + 71 202-32-82 + '">71 202-32-82</a>,<a dir="ltr"
                                                                                                           href="tel:+' + 1198 + '">
            1198</a>
        </footer>

    </div>

</div>

<script>
    var resizefunc = [];
</script>


<script th:src="@{/static/js/jquery-3.4.1.min.js}"></script>
<script th:src="@{/static/js/jquery.app.js}"></script>
<script th:src="@{/static/js/bootstrap.min.js}"></script>
<script th:src="@{/static/plugins/bootstrap-sweetalert/sweet-alert.min.js}"></script>
<script th:src="@{/static/plugins/datatables/jquery.dataTables.min.js}"></script>
<script th:src="@{/static/plugins/datatables/spring.friendly.js}"></script>
<script th:src="@{/static/plugins/datatables/dataTables.bootstrap.js}"></script>

<script th:inline="javascript" type="text/javascript">
    /*<![CDATA[*/
    !function ($) {


        $(document).ready(function () {
            const authority = [[${#authentication.getAuthorities().get(0).authority}]];
            $(document).on('click', '#exampleModal', function () {


                var exampleModal = document.getElementById('exampleModal')
                exampleModal.addEventListener('show.bs.modal', function (event) {
                    var button = event.relatedTarget
                    var recipient = button.getAttribute('data-bs-whatever')

                    var modalTitle = exampleModal.querySelector('.modal-title')
                    var modalBodyInput = exampleModal.querySelector('.modal-body input')

                    modalTitle.textContent = 'New message to ' + recipient
                    modalBodyInput.value = recipient
                })
            });

            function formatDatetime(date, notBreak) {
                let time = formatTimeHHmm(date);
                date = formatDate(date);
                return notBreak ? time + " " + date : date + "<br/> " + time;
            }

            function formatTimeHHmm(date) {
                let d = new Date(date),
                    hours = '' + d.getHours(),
                    minutes = '' + d.getMinutes();
                if (hours.length < 2) hours = '0' + hours;
                if (minutes.length < 2) minutes = '0' + minutes;
                return [hours, minutes].join(':');
            }

            function formatDate(date) {
                let d = new Date(date),
                    month = '' + (d.getMonth() + 1),
                    day = '' + d.getDate(),
                    year = d.getFullYear() % 2000;

                if (month.length < 2) month = '0' + month;
                if (day.length < 2) day = '0' + day;

                return [day, month, year].join('.');

            }


            function callDeleteDialog(event, url) {
                event.preventDefault();
                swal({
                    title: ('are_you_sure_delete_row'),
                    type: "error",
                    showCancelButton: true,
                    confirmButtonText: ('del'),
                    confirmButtonClass: 'btn-danger m-l-10',
                    cancelButtonText: ('canc'),
                    closeOnConfirm: false
                }, function () {
                    deleteRow(url)
                });
            }


            $('#datatable').DataTable({
                ajax: '/employees/data',
                responsive: true,
                autoWidth: false,
                processing: true,
                serverSide: true,
                pageLength: 25,
                order: [1, "desc"],
                columns: [
                    {
                        data: "id", render: function (data) {
                            switch (data.toString().length) {
                                case 0:
                                    return "";
                                case 1:
                                    return "0000000" + data;
                                case 2:
                                    return "000000" + data;
                                case 3:
                                    return "00000" + data;
                                case 4:
                                    return "0000" + data;
                                case 5:
                                    return "000" + data;
                                case 6:
                                    return "00" + data;
                                case 7:
                                    return "0" + data;
                                default:
                                    return data;
                            }
                        },
                    },
                    {
                        data: "name", render: function (data) {
                            return data;
                        }
                    },
                    {
                        data: "phoneNumber", render: function (data) {
                            return '<a dir="ltr" href="tel:+' + data + '">' + data + '</a>';
                        }
                    },
                    // {data: "bank.name", "visible": false},
                    {data: "userRole"},
                    {
                        data: "email", render: function (mail) {
                            return "<a href='mailto:" + mail + "'>" + mail + "</a>";
                        }
                    },
                    {
                        data: "position", render: function (data) {
                            return data;
                        }
                    },
                    {
                        data: "salary", render: function (data) {
                            return data;
                        }
                    },
                    {
                        data: "createdAt", render: function (createdAt) {
                            return formatDatetime(createdAt);
                        }
                    },

                    {
                        data: "id", render: function (id, t, r) {
                            let html = `<a href="?page=leads&profile=${id}" style="width: 30px; height: 30px" class="table-action-btn"><span class="fa fa-search"/></a>`;
                            if (authority !== "ROLE_USER") {
                                html += `<a href="/employees/form?id=${encodeURIComponent(id)}" class="table-action-btn get-modal" modalsize="xl"><span class="fa fa-edit"/></a>`;
                            }
                            if (authority !== "ROLE_USER") {
                                html += `<a href="/employees/delete/${encodeURIComponent(id)}"  id="deleteButton" class="table-action-btn delete-modal"><span class="fa fa-trash-o"/></a>`;
                            }
                            return html;
                        }, className: 'actions', orderable: false, searchable: false
                    }
                ]
            });

        });

        $(document).ready(function () {
            $("#deleteButton").click(function (e) {
                e.preventDefault();
                $.ajax({
                    url: $(this).attr('href'),
                    type: "DELETE",
                    success: function (response) {
                        window.location.href = "/employees"
                        $('#datatable').DataTable().ajax.reload();
                        console.log("responseSuccess: " + response.status);
                        console.log("responseSuccess: " + response);

                    },
                    error: function (data) {
                        $('#datatable').DataTable().ajax.reload();
                        console.log("responseError: " + data.status);
                        console.log("responseError11: " + data);
                    }
                });

            });
        });
    }(window.jQuery);
    /*]]>*/
</script>


</body>
</html>